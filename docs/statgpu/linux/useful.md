---
tags:
  - ssh
  - programming
  - manual
---

# 기타 유용한 팁들

## 1 SSH의 다른 기능들

앞서 서버에 접속하기 위한 방법으로 SSH를 다뤘었는데, SSH는 단순히 서버에
명령어를 보내는 기능 외에 여러 다양하고 유용한 기능들을 가지고 있다. 주로
암호화된 보안 접속 위에서 안전하게 서버와 통신한다는 점을 바탕으로 많은
기능들이 개발되었는데, 여기서는 그 중 자주 쓰이는 파일 전송과 SSH 터널링에 대해
다룬다.

### 1.1 파일 전송

SSH를 이용한 파일 전송 규격인 SCP가 개발되어 있으며, 이를 기반으로 SFTP나 rsync
등 다양한 전송 규격들이 구현되어 있다. 이러한 전송 규격들을 이용해 클라이언트와
서버 사이 쉽게 파일들을 주고 받을 수 있다.

SSH를 이용한 파일 전송 중에서 가장 쉬운 방법 중 하나는 [FileZilla]로 SFTP를
사용하는 것이다. FileZilla는 가장 대중적인 FTP 클라이언트 중 하나로, 직관적인
GUI 기반이기 때문에 쉽게 사용할 수 있다. FileZilla로 SFTP를 쓰기 위해서는 SSH로
접속할 때와 동일한 주소, 포트, 계정을 이용하여 접속하면 된다.

### 1.2 SSH 터널링

SSH 터널링이란 SSH 접속을 다른 프로그램이 사용할수 있도록 포트 포워딩해주는
것을 말한다. SSH 터널링의 효과는 두 가지인데 (i) 암호화 접속을 사용하지 않는
프토로콜을 SSH로 암호화시켜 보다 안전하게 사용하도록 하며 (ii) 방화벽으로
외부 포트를 막아놓은 경우 SSH 터널링을 이용하여 이를 우회할 수 있다.

간단한 예를 들어보자. 먼저 서버에서 다음과 같은 프로그램을 실행하자[^useful-1].

[^useful-1]: Python3의 내장 모듈 중 하나인데, 현재 디렉토리의 파일들을 보여주는
    간단한 웹 서버이다. 필자는 (진짜 귀찮을때) 임시 파일 전송용으로 써먹는데
    꽤나 편하다.

```bash
~ ssh -p 2222 alice@server.address.com
$ python3 -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```

이제 웹 브라우저를 열어서 `http://server.address.com:8000`으로 접속을
해보자. 만일 서버에서 8000번 포트를 방화벽으로 막은 상황이면 접속시 페이지가
뜨지 않는 것을 확인할 수 있다. 방화벽으로 막지 않아 페이지가 뜬 경우도 연결이
전혀 암호화되지 않은 상태로, 단순한 웹 서버가 아니라 개인정보나 비밀번호를
주고받는 서비스를 이용하고자 하는 경우면 이는 심각한 보안 결함점이 될 수 있다.

SSH 터널링을 이용하여 이를 해결해보자. SSH로 접속을 할 때 `-L` 플래그를 다음과
같이 추가한다:
```bash
~ ssh -p 2222 alice@server.address.com -L 9000:localhost:8000
$ python3 -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```
SSH 접속을 *끊지 않은 채로*, `http://server.address.com:8000` *대신*
`http://localhost:9000`로 접속하면 웹 서버가 정상적으로 뜨는 것을 확인할 수
있다. 이것이 터널링의 효과인데, 클라이언트의 9000번 포트로 들어온 모든 접속이
서버의 localhost 8000번 포트로 포워딩되기 때문이다. 포워딩 중간의 모든 과정은
(이미 연결된) SSH 프토토콜 위에서 진행되므로 암호화가 된 상태이며 방화벽도
우회할 수 있는 것이다.

## 2 터미널 세션 관리: tmux

SSH 터미널의 경우, 접속을 종료하거나 접속이 끊기면 그 순간 터미널에서 진행되고
있던 모든 작업들이 *강제로 종료되게* 된다. 이를 방지하기 위한 하나의 방법으로
`tmux`를 사용하는 법이 있다.

다음 명령어를 입력하면 새 tmux 세션을 생성한다. tmux 세션들은 터미널 아래에
초록색 줄이 보이므로 쉽게 구분할 수 있다.
```bash
$ tmux new -s session-name
```

tmux 세션 창에서, `ctrl-b d`를 입력하면 세션이 detach되게 된다. detach된 세션은
완전히 종료된 것이 아니라 background에서 계속 실행되고 있는 상태이므로, 다음
명령어를 통해 다시 attach 할 수 있다:
```bash
$ tmux attach -t session-name
```
이렇게 tmux에서 관리되는 세션은 중간에 터미널 접속이 끊기더라도 그래도
유지된다. 세션을 완전히 종료하고 싶은 경우는 tmux 세션에서 `exit` 명령어로 tmux
세션의 모든 쉘을 종료시키면 된다.

필자의 경우 아예 `.bashrc` 파일 마지막에 다음과 같은 스크립트를 추가했다.
SSH 접속을 할 때마다 자동적으로 기존 작업하던 tmux 세션을 attach하며, 기존
세션이 없는 경우에는 새로 세션을 만드는 스크립트이다.
```.bash
# $HOME/.bashrc 파일 내용 중 일부
if [[ "$TERM" != "dumb" && -z "$TMUX" && -n "$SSH_TTY" ]]; then
  if tmux has-session -t ssh 2>/dev/null; then
    exec tmux -2 attach-session -t ssh
  else
    exec tmux -2 new-session -s ssh
  fi
fi
```

한 가지 불편한 점은, tmux 세션에서는 마우스 휠을 이용해 쉘의 스크롤을 이동할 수
없다. 대신 copy mode로 들어간 다음 화살표키나 `PageUp`, `PageDown` 키를
이용하여 스크롤을 이동할 수 있다. Copy mode는 `ctrl-b [`로 진입할 수 있으며,
`ESC` 키를 이용하여 빠져나올 수 있다.

tmux는 뿐만 아니라 터미널 창 분할이나 공유 등 다양한 기능을 가지고 있다. 자세한
사항은 man page나 구글링으로 찾아보길 바란다.

## 3 스마트폰으로 알림 전송: Pushover

서버에서 언제 끝날지 감이 잡히지 않는 프로그램을 돌리고자 할 때가 자주
있을텐데, 이 경우 서버에서 실행된 프로그램이 언제 종료되었는지, 혹은 버그가
발생했는지 아니면 성공적으로 끝마쳤는지 등이 우리의 주 관심사이다. 이를 서버에
매번 들어가서 확인하는 번거로운 방식 대신 서버에 특정 이벤트가 발생하였을 때
메일이나 알림 등으로 알리는 것이 훨씬 편한 방식일 것이다. [Pushover]를 사용하면
서버에서 스마트폰으로 쉽게 알림을 전송할 수 있다. 거의 모든 프로그래밍 언어의
API를 가지고 있어 쉽게 사용할 수 있으나 알림을 받는 기기 하나당 $5를 지불하고
앱을 구매해야 한다. 자세한 내용은 공식 홈페이지를 확인.

[FileZilla]: https://filezilla-project.org/
[Pushover]: https://pushover.net/
